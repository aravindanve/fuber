+function(a,b,c){function d(b){a(D).html(b).parent().css("display","block")}function e(){a(D).parent().css("display","")}function f(a){d(a)}function g(b,c,d,e){"function"==typeof d&&(e=d),a.ajax({type:b,url:C+c,data:d||null,dataType:"json",success:function(a){if(a.error){var b=(a.name?a.name+": ":"")+a.message;return f(b)}return e(a)},error:function(a){if(a&&a.responseJSON&&a.responseJSON.message){var b=(a.responseJSON.name?a.responseJSON.name+": ":"")+a.responseJSON.message;return f(b)}return f("Oops, something went wrong")}})}function h(){a(F).css("display","none"),a(G).css("display","block")}function i(){a(F).css("display",""),a(G).css("display",""),k()}function j(){a(W).removeClass("current"),i()}function k(){e(),y(),n()}function l(a){return{lng:600*(a[0]-76)+100,lat:600*(a[1]-12)+50}}function m(a,b){return{lng:(a-100)/600+76,lat:(b-50)/600+12}}function n(){g("get","/actions/getCars",function(b){a(L).empty(),b.cars.forEach(function(b,c){var d=l(b.location),e=d.lng,f=d.lat;a(L).append(fa.replace(/%ID%/g,b._id).replace(/%LNG%/g,e).replace(/%LAT%/g,f).replace(/%PINK%/g,b.isPink?" pink":""))})})}function o(b){if(a(this).filter(X).length){var c=b.pageX-a(this).position().left-$,d=b.pageY-a(this).position().top,e=m(c,d);a(Z).remove(),a(this).append(ga.replace(/%LNG%/,c).replace(/%LAT%/,d)),p(e.lng,e.lat)}}function p(b,c){a(H).html("Location"),ea&&ea.ride?(a(I).html(ia.replace(/%ID%/g,ea.ride).replace(/%USERNAME%/g,ea.username).replace(/%LOCATION%/g,[b,c].join(", "))),h()):ea?(a(I).html(ha.replace(/%ID%/g,ea._id).replace(/%USERNAME%/g,ea.username).replace(/%LOCATION%/g,[b,c].join(", "))),h()):(a(I).html(ja),h())}function q(b){var c=a(this).parent(),d=c.attr(aa),e=c.attr(ba),f=a(this).attr(ca);e=e.replace(/\s/g,"").split(","),g("put","/actions/requestCar",{userId:d,lng:e[0],lat:e[1],pink:f},function(b){b.status&&"rideStarted"==b.status?(a(H).html("Ride Started"),a(I).html("Click anywhere on the map to end ride")):(a(H).html("Unavailable"),a(I).html("Sorry there are no cars available at this moment.")),h(),k()})}function r(b){var c=a(this).parent(),d=c.attr(aa),e=c.attr(ba);e=e.replace(/\s/g,"").split(","),g("put","/actions/stopRide",{rideId:d,lng:e[0],lat:e[1]},function(b){b.status&&"rideEnded"==b.status?(a(H).html("Ride Ended"),a(I).html(ka.replace(/%ID%/g,b.ride._id).replace(/%USERNAME%/g,ea.username).replace(/%DISTANCE%/g,Math.round(100*b.ride.distance)/100+" km").replace(/%TIME%/g,Math.round(100*b.ride.time)/100+" min").replace(/%PINK%/g,b.ride.pinkCarRequested?"5.00 dogecoins":"0").replace(/%BILL%/g,b.ride.tripCost.toFixed(2)+" dogecoins"))):(a(H).html("Unavailable"),a(I).html("Something went wrong, unable to stop the ride.")),h(),k()})}function s(){return{lng:77-Math.round(1e7*Math.random())/1e7,lat:13-Math.round(1e7*Math.random())/1e7}}function t(){return Math.round(Math.random())?"true":"false"}function u(b){function c(){++e>=d&&k()}var d=parseInt(a(N).val()),e=0;if(isNaN(d)&&(d=0),!d)return!1;for(var f=0;f<d;f++)g("post","/car",{driver:"random car",pink:t()},function(a){var b=s();g("put","/car/location",{id:a.car._id,lng:b.lng,lat:b.lat},function(a){c()})})}function v(b){return g("delete","/car",{id:a(this).attr(U)},function(a){i(),k()}),!1}function w(a){g("get","/actions/getCars",{active:1},function(a){function b(){++c>=a.cars.length&&k()}var c=0;a.cars.forEach(function(a,c){g("delete","/car",{id:a._id},function(a){b()})})})}function x(b){var c=a(this),d=c.attr(Y);return g("get","/car",{id:d},function(b){a(W).removeClass("current"),c.addClass("current"),a(H).html("Car"),a(I).html(la.replace(/%ID%/g,b.car._id).replace(/%DRIVER%/g,b.car.driver).replace(/%LOCATION%/g,b.car.location.join(", ")).replace(/%PINK%/g,b.car.isPink?"true":"false")),h()}),a(Z).remove(),!1}function y(){g("get","/actions/getUsers",function(b){a(K).empty(),b.users.forEach(function(b,c){var d=b.ride&&b.ride?" active":"",e=d?"ride active":"inactive",f=ea&&ea.username==b.username?" current":"";f&&(ea=b),a(K).append(ma.replace(/%CURRENT%/g,f).replace(/%USERNAME%/g,b.username).replace(/%ID%/g,b._id).replace(/%ACTIVECLASS%/g,d).replace(/%ACTIVE%/g,e))}),a(Q).filter(".current").length||(ea=null)})}function z(b){var c=a(M).val();g("post","/user",{username:c},function(b){a(M).val(""),k()})}function A(b){var c=a(this).siblings(Q).attr(R);g("delete","/user",{username:c},function(a){k()})}function B(b){var c=a(this);g("get","/user",{username:c.attr(R)},function(b){a(Q).removeClass("current"),c.addClass("current"),ea=b.user})}var C="/api",D="[data-message]",E="[data-clear-message]",F="[data-panel-main]",G="[data-panel-page]",H="[data-pp-title]",I="[data-pp-content]",J="[data-show-main]",K="[data-users]",L="[data-cars]",M='[name="new-user"]',N='[name="new-cars"]',O="[data-add-user]",P="[data-remove-user]",Q="[data-user]",R="data-user",S="[data-add-cars]",T="[data-delete-car]",U="data-delete-car",V="[data-delete-cars]",W="[data-car]",X=".action-layer",Y="data-car",Z="[data-location]",$=350,_="[data-request-car]",aa="data-request-id",ba="data-request-location",ca="data-request-pink",da="[data-stop-ride]",ea=null,fa='<a class="car%PINK%" data-car="%ID%" style="left: %LNG%px; top: %LAT%px;"></a>',ga='<a class="location current" data-location="%COORD%" style="left: %LNG%px; top: %LAT%px;"></a>',ha='<div class="props"><div><span class="prop-name">user</span><span class="prop-val">%USERNAME%</span></div><div><span class="prop-name">location</span><span class="prop-val">%LOCATION%</span></div></div><div class="a-input combo-2" data-request-id="%ID%" data-request-location="%LOCATION%"><button class="blue" data-request-car="%ID%" data-request-pink="false">Request Car</button><button class="pink" data-request-car="%ID%" data-request-pink="true">Request Pink Car</button></div>',ia='<div class="props"><div><span class="prop-name">user</span><span class="prop-val">%USERNAME%</span></div><div><span class="prop-name">location</span><span class="prop-val">%LOCATION%</span></div></div><div class="a-input combo-2" data-request-id="%ID%" data-request-location="%LOCATION%"><button class="blue" data-stop-ride="%ID%">Stop Ride Here</button></div>',ja="You must go back and select a user to request a car",ka='<div class="props"><div><span class="prop-name">ID</span><span class="prop-val">%ID%</span></div><div><span class="prop-name">user</span><span class="prop-val">%USERNAME%</span></div><div><span class="prop-name">distance</span><span class="prop-val">%DISTANCE%</span></div><div><span class="prop-name">time</span><span class="prop-val">%TIME%</span></div><div><span class="prop-name">pinkCharge</span><span class="prop-val">%PINK%</span></div><div><span class="prop-name">bill amount</span><span class="prop-val">%BILL%</span></div></div>',la='<div class="props"><div><span class="prop-name">ID</span><span class="prop-val">%ID%</span></div><div><span class="prop-name">driver</span><span class="prop-val">%DRIVER%</span></div><div><span class="prop-name">location</span><span class="prop-val">%LOCATION%</span></div><div><span class="prop-name">isPink</span><span class="prop-val">%PINK%</span></div></div><button class="red" data-delete-car="%ID%">Delete Car</button>',ma='<div class="customer"><a class="user%CURRENT%" data-user="%USERNAME%" data-id="%ID%"><div class="u-name">%USERNAME%</div><div class="u-status%ACTIVECLASS%">%ACTIVE%</div></a><a class="user-remove" data-remove-user>&times;</a></div>';a(b).ready(function(){a(b).on("click",E,e),a(b).on("click",J,j),a(b).on("click",O,z),a(b).on("click",P,A),a(b).on("click",Q,B),a(b).on("click",S,u),a(b).on("click",T,v),a(b).on("click",V,w),a(b).on("click",W,x),a(b).on("click",X,o),a(b).on("click",_,q),a(b).on("click",da,r),k(),d("Start booking cabs now!")})}(jQuery,document,window);