+function(a,b,c){function d(b){a("[data-message]").html(b)}function e(b,c,e,f){"function"==typeof e&&(f=e),a.ajax({type:b,url:s+c,data:e||null,dataType:"json",success:function(a){if(a.error){var b=(a.name?a.name+": ":"")+a.message;return d(b)}return f(a)},error:function(a){if(a&&a.responseJSON&&a.responseJSON.message){var b=(a.responseJSON.name?a.responseJSON.name+": ":"")+a.responseJSON.message;return d(b)}return d("Oops, something went wrong")}})}function f(){n(),o(),g()}function g(){e("get","/actions/getCars",function(b){a("[data-cars]").empty(),b.cars.forEach(function(b,c){var d=600*(b.location[0]-76)+100,e=600*(b.location[1]-12)+50;a("[data-cars]").append(u.replace(/%ID%/g,b._id).replace(/%LNG%/g,d).replace(/%LAT%/g,e).replace(/%PINK%/g,b.isPink?" pink":""))})})}function h(){return{lng:77-Math.round(1e7*Math.random())/1e7,lat:13-Math.round(1e7*Math.random())/1e7}}function i(){return Math.round(Math.random())?"true":"false"}function j(b){function c(){++g>=d&&(a('[name="new-user"]').val(""),f())}var d=parseInt(a('[name="new-cars"]').val());if(isNaN(d)&&(d=0),console.log(d),!d)return!1;for(var g=0,j=0;j<d;j++)e("post","/car",{driver:"random car",pink:i()},function(a){var b=h();e("put","/car/location",{id:a.car._id,lng:b.lng,lat:b.lat},function(a){c()})})}function k(b){return e("delete","/car",{id:a(this).attr("data-delete-car")},function(a){f()}),!1}function l(a){e("get","/actions/getCars",function(a){function b(){++c>=a.cars.length&&f()}var c=0;a.cars.forEach(function(a,c){e("delete","/car",{id:a._id},function(a){b()})})})}function m(b){var c=a(this).position(),d=c.left,f=c.top,g=a("[data-cars]").width(),h=a("[data-cars]").height(),i=!0,j=!0,k=!0,l=!0;return d>g/2?(a("[data-popup]").css({left:"auto",right:g-d-5+"px"}),l=!1):(a("[data-popup]").css({right:"auto",left:d+5+350+"px"}),j=!1),f>h/2?(a("[data-popup]").css({top:"auto",bottom:h-f-5+"px"}),i=!1):(a("[data-popup]").css({bottom:"auto",top:f+5+"px"}),k=!1),a("[data-popup]").css({display:"block",borderRadius:(l&&i?"0":"6px")+" "+(i&&j?"0":"6px")+" "+(j&&k?"0":"6px")+" "+(k&&l?"0":"6px")}),e("get","/car",{id:a(this).data("car")},function(b){a("[data-popup]").empty().append(v.replace(/%ID%/g,b.car._id))}),!1}function n(b){a("[data-popup]").css("display","")}function o(){e("get","/actions/getUsers",function(b){a("[data-customers]").empty(),b.users.forEach(function(b,c){a("[data-customers]").append(w.replace(/%NAME%/g,b.username))}),t&&a('[data-user="'+t+'"]').length?a('[data-user="'+t+'"]').addClass("current"):a("[data-user]").removeClass("current")})}function p(b){var c=a('[name="new-user"]').val();e("post","/user",{username:c},function(b){a('[name="new-user"]').val(""),f()})}function q(b){var c=a(this).siblings("[data-user]").data("user");e("delete","/user",{username:c},function(a){f()})}function r(b){a("[data-user]").removeClass("current"),a(this).addClass("current"),t=a(this).data("user")}var s="/api",t=null,u='<a class="car%PINK%" data-car="%ID%" style="left: %LNG%px; top: %LAT%px;"></a>',v='<button class="red" data-delete-car="%ID%">Delete Car</button>',w='<div class="customer"><a class="user" data-user="%NAME%"><div class="u-name">%NAME%</div><div class="u-status">trip active</div></a><a class="user-remove" data-remove-user>&times;</a></div>';a(b).ready(function(){a(b).on("click","[data-add-user]",p),a(b).on("click","[data-remove-user]",q),a(b).on("click","[data-user]",r),a(b).on("click","[data-add-cars]",j),a(b).on("click","[data-delete-car]",k),a(b).on("click","[data-delete-cars]",l),a(b).on("click","[data-car]",m),a(b).on("click","[data-popup]",function(a){return!1}),a(b).on("click",n),f()})}(jQuery,document,window);