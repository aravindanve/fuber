+function(a,b,c){function d(b){a(E).html(b).parent().css("display","block")}function e(){a(E).parent().css("display","")}function f(a){d(a)}function g(b,c,d,e){"function"==typeof d&&(e=d),a.ajax({type:b,url:D+c,data:d||null,dataType:"json",success:function(a){if(a.error){var b=(a.name?a.name+": ":"")+a.message;return f(b)}return e(a)},error:function(a){if(a&&a.responseJSON&&a.responseJSON.message){var b=(a.responseJSON.name?a.responseJSON.name+": ":"")+a.responseJSON.message;return f(b)}return f("Oops, something went wrong")}})}function h(){a(G).css("display","none"),a(H).css("display","block")}function i(){a(G).css("display",""),a(H).css("display",""),k()}function j(){a(X).removeClass("current"),i()}function k(){e(),y(),n()}function l(a){return{lng:600*(a[0]-76)+100,lat:600*(a[1]-12)+50}}function m(a,b){return{lng:(a-100)/600+76,lat:(b-50)/600+12}}function n(){g("get","/actions/getCars",function(b){a(M).empty(),b.cars.forEach(function(b,c){var d=l(b.location),e=d.lng,f=d.lat;a(M).append(ga.replace(/%ID%/g,b._id).replace(/%LNG%/g,e).replace(/%LAT%/g,f).replace(/%PINK%/g,b.isPink?" pink":""))})})}function o(b){if(a(this).filter(Y).length){var c=b.pageX-a(this).position().left-_,d=b.pageY-a(this).position().top,e=m(c,d);a($).remove(),a(this).append(ha.replace(/%LNG%/,c).replace(/%LAT%/,d)),p(e.lng,e.lat)}}function p(b,c){a(I).html("Location"),fa&&fa.ride?(a(J).html(ja.replace(/%ID%/g,fa.ride).replace(/%USERNAME%/g,fa.username).replace(/%LOCATION%/g,[b,c].join(", "))),h()):fa?(a(J).html(ia.replace(/%ID%/g,fa._id).replace(/%USERNAME%/g,fa.username).replace(/%LOCATION%/g,[b,c].join(", "))),h()):(a(J).html(ka),h())}function q(b){var c=a(this).parent(),d=c.attr(ba),e=c.attr(ca),f=a(this).attr(da);e=e.replace(/\s/g,"").split(","),g("put","/actions/requestCar",{userId:d,lng:e[0],lat:e[1],pink:f},function(b){C(function(){b.status&&"rideStarted"==b.status?(a(I).html("Ride Started"),a(J).html("Click anywhere on the map to end ride")):(a(I).html("Unavailable"),a(J).html("Sorry there are no cars available at this moment.")),h(),k()})})}function r(b){var c=a(this).parent(),d=c.attr(ba),e=c.attr(ca);e=e.replace(/\s/g,"").split(","),g("put","/actions/stopRide",{rideId:d,lng:e[0],lat:e[1]},function(b){C(function(){b.status&&"rideEnded"==b.status?(a(I).html("Ride Ended"),a(J).html(la.replace(/%ID%/g,b.ride._id).replace(/%USERNAME%/g,fa.username).replace(/%DISTANCE%/g,Math.round(100*b.ride.distance)/100+" km").replace(/%TIME%/g,Math.round(100*b.ride.time)/100+" min").replace(/%PINK%/g,b.ride.pinkCarRequested?"5.00 dogecoins":"0").replace(/%BILL%/g,b.ride.tripCost.toFixed(2)+" dogecoins"))):(a(I).html("Unavailable"),a(J).html("Something went wrong, unable to stop the ride.")),h(),k()})})}function s(){return{lng:77-Math.round(1e7*Math.random())/1e7,lat:13-Math.round(1e7*Math.random())/1e7}}function t(){return Math.round(Math.random())?"true":"false"}function u(b){function c(){++e>=d&&k()}var d=parseInt(a(O).val()),e=0;if(isNaN(d)&&(d=0),!d)return!1;for(var f=0;f<d;f++)g("post","/car",{driver:"random car",pink:t()},function(a){var b=s();g("put","/car/location",{id:a.car._id,lng:b.lng,lat:b.lat},function(a){c()})})}function v(b){return g("delete","/car",{id:a(this).attr(V)},function(a){i(),k()}),!1}function w(a){g("get","/actions/getCars",{active:1},function(a){function b(){++c>=a.cars.length&&k()}var c=0;a.cars.forEach(function(a,c){g("delete","/car",{id:a._id},function(a){b()})})})}function x(b){var c=a(this),d=c.attr(Z);return g("get","/car",{id:d},function(b){a(X).removeClass("current"),c.addClass("current"),a(I).html("Car"),a(J).html(ma.replace(/%ID%/g,b.car._id).replace(/%DRIVER%/g,b.car.driver).replace(/%LOCATION%/g,b.car.location.join(", ")).replace(/%PINK%/g,b.car.isPink?"true":"false")),h()}),a($).remove(),!1}function y(){g("get","/actions/getUsers",function(b){a(L).empty(),b.users.forEach(function(b,c){var d=b.ride&&b.ride?" active":"",e=d?"ride active":"inactive",f=fa&&fa.username==b.username?" current":"";f&&(fa=b),a(L).append(na.replace(/%CURRENT%/g,f).replace(/%USERNAME%/g,b.username).replace(/%ID%/g,b._id).replace(/%ACTIVECLASS%/g,d).replace(/%ACTIVE%/g,e))}),a(R).filter(".current").length||(fa=null)})}function z(b){var c=a(N).val();g("post","/user",{username:c},function(b){a(N).val(""),k()})}function A(b){var c=a(this).siblings(R).attr(S);g("delete","/user",{username:c},function(a){k()})}function B(b){var c=a(this);g("get","/user",{username:c.attr(S)},function(b){a(R).removeClass("current"),c.addClass("current"),fa=b.user})}function C(a){fa&&g("get","/user",{username:fa.username},function(b){return fa=b.user,a()})}var D="/api",E="[data-message]",F="[data-clear-message]",G="[data-panel-main]",H="[data-panel-page]",I="[data-pp-title]",J="[data-pp-content]",K="[data-show-main]",L="[data-users]",M="[data-cars]",N='[name="new-user"]',O='[name="new-cars"]',P="[data-add-user]",Q="[data-remove-user]",R="[data-user]",S="data-user",T="[data-add-cars]",U="[data-delete-car]",V="data-delete-car",W="[data-delete-cars]",X="[data-car]",Y=".action-layer",Z="data-car",$="[data-location]",_=350,aa="[data-request-car]",ba="data-request-id",ca="data-request-location",da="data-request-pink",ea="[data-stop-ride]",fa=null,ga='<a class="car%PINK%" data-car="%ID%" style="left: %LNG%px; top: %LAT%px;"></a>',ha='<a class="location current" data-location="%COORD%" style="left: %LNG%px; top: %LAT%px;"></a>',ia='<div class="props"><div><span class="prop-name">user</span><span class="prop-val">%USERNAME%</span></div><div><span class="prop-name">location</span><span class="prop-val">%LOCATION%</span></div></div><div class="a-input combo-2" data-request-id="%ID%" data-request-location="%LOCATION%"><button class="blue" data-request-car="%ID%" data-request-pink="false">Request Car</button><button class="pink" data-request-car="%ID%" data-request-pink="true">Request Pink Car</button></div>',ja='<div class="props"><div><span class="prop-name">user</span><span class="prop-val">%USERNAME%</span></div><div><span class="prop-name">location</span><span class="prop-val">%LOCATION%</span></div></div><div class="a-input combo-2" data-request-id="%ID%" data-request-location="%LOCATION%"><button class="blue" data-stop-ride="%ID%">Stop Ride Here</button></div>',ka="You must go back and select a user to request a car",la='<div class="props"><div><span class="prop-name">ID</span><span class="prop-val">%ID%</span></div><div><span class="prop-name">user</span><span class="prop-val">%USERNAME%</span></div><div><span class="prop-name">distance</span><span class="prop-val">%DISTANCE%</span></div><div><span class="prop-name">time</span><span class="prop-val">%TIME%</span></div><div><span class="prop-name">pinkCharge</span><span class="prop-val">%PINK%</span></div><div><span class="prop-name">bill amount</span><span class="prop-val">%BILL%</span></div></div>',ma='<div class="props"><div><span class="prop-name">ID</span><span class="prop-val">%ID%</span></div><div><span class="prop-name">driver</span><span class="prop-val">%DRIVER%</span></div><div><span class="prop-name">location</span><span class="prop-val">%LOCATION%</span></div><div><span class="prop-name">isPink</span><span class="prop-val">%PINK%</span></div></div><button class="red" data-delete-car="%ID%">Delete Car</button>',na='<div class="customer"><a class="user%CURRENT%" data-user="%USERNAME%" data-id="%ID%"><div class="u-name">%USERNAME%</div><div class="u-status%ACTIVECLASS%">%ACTIVE%</div></a><a class="user-remove" data-remove-user>&times;</a></div>';a(b).ready(function(){a(b).on("click",F,e),a(b).on("click",K,j),a(b).on("click",P,z),a(b).on("click",Q,A),a(b).on("click",R,B),a(b).on("click",T,u),a(b).on("click",U,v),a(b).on("click",W,w),a(b).on("click",X,x),a(b).on("click",Y,o),a(b).on("click",aa,q),a(b).on("click",ea,r),k(),d("Start booking cabs now!")})}(jQuery,document,window);